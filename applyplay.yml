---
- name: Apply Kubernetes manifest
  hosts: all
  gather_facts: no
  tasks:
    - name: Copy manifest to remote host
      ansible.builtin.copy:
        src: "./ip-locator.yml"
        dest: "/tmp/ip-locator.yml"
        mode: '0644'

    - name: Apply ingress manifest
      shell: |
          kubectl apply -f /tmp/ksm-ingress.yml
      environment:
        KUBECONFIG: /etc/kubernetes/admin.conf